<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow Boxing Game</title>
    <link rel="stylesheet" href="styles.css">
    <!-- MediaPipe for face detection -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <!-- Main Menu Screen -->
        <div id="menuScreen" class="screen active">
            <h1>ü•ä Shadow Boxing</h1>
            <p class="subtitle">Real-time head tracking battle!</p>

            <div class="menu-buttons">
                <button id="createMatchBtn" class="btn btn-primary">Create Match</button>
                <button id="joinMatchBtn" class="btn btn-secondary">Join Match</button>
            </div>

            <div id="joinForm" class="hidden">
                <input type="text" id="matchCodeInput" placeholder="Enter Match Code" maxlength="6">
                <button id="confirmJoinBtn" class="btn btn-primary">Join</button>
            </div>

            <div id="matchCodeDisplay" class="hidden">
                <p>Your Match Code:</p>
                <h2 id="generatedCode"></h2>
                <p class="waiting-text">Waiting for opponent...</p>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <div class="game-header">
                <div class="player-info">
                    <span class="player-label" id="yourLabel">You</span>
                    <span id="playerScore" class="score">0</span>
                </div>
                <div class="round-info">
                    <div class="timer-display">
                        <span id="roundTimer">30</span>s
                    </div>
                    <div class="round-counter">
                        Round <span id="currentRound">1</span>/<span id="totalRounds">4</span>
                    </div>
                </div>
                <div class="player-info">
                    <span class="player-label">Opponent</span>
                    <span id="opponentScore" class="score">0</span>
                </div>
            </div>

            <div id="gameContent">
                <!-- Waiting Screen -->
                <div id="waitingScreen" class="game-section hidden">
                    <div class="waiting-animation">
                        <div class="spinner"></div>
                    </div>
                    <h2 id="waitingText">Waiting for opponent...</h2>
                </div>

                <!-- Countdown Screen -->
                <div id="countdownScreen" class="game-section hidden">
                    <h2 id="roleAnnouncement">Get Ready!</h2>
                    <div id="countdownNumber" class="countdown-number">3</div>
                    <p id="roleDescription">Prepare for the round...</p>
                </div>

                <!-- Attacker Screen -->
                <div id="attackerScreen" class="game-section hidden">
                    <h2>‚öîÔ∏è YOU ARE ATTACKING</h2>
                    <p class="instructions">Press arrow keys to send moves!</p>

                    <div class="arrow-keys-display">
                        <div class="key-row">
                            <div class="arrow-key" id="keyUp">‚¨ÜÔ∏è</div>
                        </div>
                        <div class="key-row">
                            <div class="arrow-key" id="keyLeft">‚¨ÖÔ∏è</div>
                            <div class="arrow-key" id="keyDown">‚¨áÔ∏è</div>
                            <div class="arrow-key" id="keyRight">‚û°Ô∏è</div>
                        </div>
                    </div>

                    <div class="last-move-sent">
                        <p>Last move sent:</p>
                        <div id="lastMoveSent" class="big-move">-</div>
                    </div>

                    <div id="opponentReaction" class="opponent-reaction hidden">
                        <span id="reactionResult"></span>
                    </div>
                </div>

                <!-- Defender Screen -->
                <div id="defenderScreen" class="game-section hidden">
                    <h2>üõ°Ô∏è YOU ARE DEFENDING</h2>

                    <div class="defender-layout">
                        <div class="incoming-move-display">
                            <p>INCOMING MOVE:</p>
                            <div id="incomingMove" class="incoming-move">-</div>
                            <div id="reactionTimer" class="reaction-timer hidden">
                                <div id="reactionTimerBar" class="reaction-timer-bar"></div>
                            </div>
                        </div>

                        <div class="tracking-container">
                            <video id="webcamVideo" autoplay playsinline muted></video>
                            <canvas id="faceCanvas"></canvas>
                            <div id="directionIndicator" class="direction-indicator"></div>
                        </div>

                        <div id="defenderFeedback" class="defender-feedback hidden">
                            <span id="feedbackText"></span>
                        </div>
                    </div>

                    <p id="calibrationStatus" class="calibration-status">Calibrating...</p>
                </div>

                <!-- Round End Screen -->
                <div id="roundEndScreen" class="game-section hidden">
                    <h2>Round Complete!</h2>
                    <div class="round-scores">
                        <div class="score-display">
                            <span>You</span>
                            <span id="roundYourScore" class="big-score">0</span>
                        </div>
                        <div class="vs">-</div>
                        <div class="score-display">
                            <span>Opponent</span>
                            <span id="roundOpponentScore" class="big-score">0</span>
                        </div>
                    </div>
                    <p id="nextRoundText">Next round starting...</p>
                </div>

                <!-- Match End Screen -->
                <div id="matchEndScreen" class="game-section hidden">
                    <h2 id="matchResultTitle">Match Over!</h2>
                    <div class="final-scores">
                        <div class="final-score">
                            <span>You</span>
                            <span id="finalPlayerScore">0</span>
                        </div>
                        <div class="vs">VS</div>
                        <div class="final-score">
                            <span>Opponent</span>
                            <span id="finalOpponentScore">0</span>
                        </div>
                    </div>
                    <div class="rematch-section">
                        <button id="rematchBtn" class="btn btn-primary">Propose Rematch</button>
                        <p id="rematchStatus" class="hidden">Waiting for opponent...</p>
                    </div>
                    <button id="exitMatchBtn" class="btn btn-secondary">Exit to Menu</button>
                </div>
            </div>
        </div>

        <!-- Notification -->
        <div id="notification" class="notification hidden"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="game.js"></script>
</body>

</html>